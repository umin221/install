webpackJsonp([2],{A71v:function(e,t,s){e.exports=s("Trbc")(198)},SoVv:function(e,t,s){e.exports=s("Trbc")(203)},cgE5:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s("woOf"),i=s.n(n),o=s("mvHQ"),r=s.n(o),a=s("Dd8w"),l=s.n(a),c=s("NYxO"),d=s("A71v"),u=s("SoVv"),m=void 0,f=void 0,h={},v=0,b="assets",p={name:b,created:function(){var e=this;KND.Event.bind("submitHook",function(t){e.queryLocalInstallRecord(function(t){e.installRecords=t,e.updateAssets++})})},activated:function(){var e=this,t=KND.Session.get("refreshAssets"),s=e.$route.query;m=s.OrderId,f=s.TaskId,e.mode=s.mode,t&&(KND.Session.remove("refreshAssets"),"turn-on"===e.$parent.transitionName&&(e.editable=!1,e.selected=0),e.clearLayer(),e.selectRooms={},e.queryBuilding({data:{OrderId:m,TaskId:f},selected:e.selected}),config.offline&&e.queryLocalInstallRecord(function(t){e.installRecords=t}))},data:function(){return{selected:0,editable:!1,mode:"",selectRooms:{},selectAll:!1,sheetVisible:!1,sheetObject:"",updateAssets:0,installRecords:""}},computed:l()({},Object(c.mapState)(b,["layer","building"]),{isSelect:function(){return"select"===this.mode},isEdit:function(){return"edit"===this.mode},hasLocalInstallRecords:function(){var e=this.installRecords,t=!1;for(var s in e)if("finish"!==e[s].state){t=!0;break}return t},layers:function(){var e=this.layer,t=this.installRecords;if(this.updateAssets++,h={},e.length){v=0;for(var s=0,n=e.length;s<n;s++){var i=e[s],o=t[i.Id],r=parseInt(i["KL Floor Number"],10);if(o){var a=KND.Util.parse(o.data)["Serial Number"];i["Serial Number"]=a,i.local="finish"!==o.state}(!this.isSelect||!i["Install Date"]&&i["Serial Number"])&&(i=this.markFn(e[s]),h[r]=h[r]||[],h[r].push(i),r>v&&(v=r))}this.selectAll=!1;for(var l in h){h[l].sort(function(e,t){return e["KL Room Number"]>t["KL Room Number"]})}}return h}}),methods:l()({},Object(c.mapMutations)(b,["clearLayer"]),Object(c.mapActions)(b,["queryBuilding","getLayer","removeBuilding","queryLocalInstallRecord","checkAndSubmit"]),{editBuildingFn:function(e){this.$router.push({name:"building",query:{id:f,room:r()(e)}})},editFloorFn:function(e){this.$router.push({name:"floor",query:{floor:r()(e)}})},getLayerFn:function(e){this.getLayer({"Original Order Id":m,"KL Activity Id":f,"KL Building Number":e})},addFloorFn:function(){for(var e=h[v],t=[],s=function(e){var t=KND.Util.now(),s=i()({},e),n=v+1;return s["KL Floor Number"]=n,s["Street Address 3"]=s["Street Address 3"].replace(v,n),s["Street Address 4"]=s["Street Address 4"].replace(v,n),s["Personal Address Id"]=t,s["ListOfKL Install Order Asset"]={"KL Install Order Asset":{"Original Order Id":s["Original Order Id"],"KL Activity Id":s["KL Activity Id"],Id:t}},s},n=0,o=e.length;n<o;n++)t.push(s(e[n]));this.$router.push({name:"floor",query:{floor:r()(t)}})},deleteBuildingFn:function(e){var t=this;MessageBox.confirm("是否删除整层？","请确认").then(function(){var s=e[0]["KL Building Number"],n=e[0]["KL Floor Number"];t.removeBuilding({data:{"Object Id":f,BuildingNum:s,FloorNum:n},success:function(e){t.getLayer({"Original Order Id":m,"KL Activity Id":f,"KL Building Number":s})}})})},roomFn:function(e){this.isEdit||(this.isSelect?e.selected?(this.$set(e,"selected",void 0),delete this.selectRooms[e.Id]):(this.$set(e,"selected","selected"),this.selectRooms[e.Id]=e):(this.sheetVisible=!0,this.sheetObject=e))},markFn:function(e){var t=this.selectRooms;return(this.selectAll||t[e.Id])&&(this.$set(e,"selected","selected"),t[e.Id]=e),e},toNextFn:function(){KND.Util.isEmptyObject(this.selectRooms)?MessageBox.alert("至少要选择一个房间","提示"):this.$router.push({name:"yjBatch",query:{result:r()(this.selectRooms)}})},toScanFn:function(){var e=this,t=this.sheetObject;tools.cordova.zBarScan(function(s){s?(t.serial=s,e.$router.push({name:"detail",query:{room:r()(t)}})):config.back=!1})},toFillFn:function(){this.$router.push({name:"detail",query:{room:r()(this.sheetObject)}})},submitFn:function(){this.checkAndSubmit()}}),components:{buttonGroup:d.default,lazy:u.default}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("mt-header",{attrs:{fixed:"",title:"项目楼层信息"}},[s("fallback",{attrs:{slot:"left"},slot:"left"}),e._v(" "),s("mt-button",{directives:[{name:"show",rawName:"v-show",value:e.isEdit,expression:"isEdit"}],attrs:{slot:"right"},domProps:{textContent:e._s(e.editable?"保存":"编辑")},nativeOn:{click:function(t){e.editable=!e.editable}},slot:"right"}),e._v(" "),s("mt-button",{directives:[{name:"show",rawName:"v-show",value:e.isSelect,expression:"isSelect"}],attrs:{slot:"right"},nativeOn:{click:function(t){e.selectAll=!0}},slot:"right"},[e._v("全选")]),e._v(" "),s("mt-button",{directives:[{name:"show",rawName:"v-show",value:!e.isEdit&&!e.isSelect&&e.hasLocalInstallRecords,expression:"!isEdit && !isSelect && hasLocalInstallRecords"}],attrs:{slot:"right"},nativeOn:{click:function(t){e.submitFn(t)}},slot:"right"},[e._v("提交")])],1),e._v(" "),s("div",{staticClass:"wrapper"},[s("div",{staticClass:"mint-content assets",class:{read:!e.editable}},[s("mt-navbar",{model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[e._l(e.building,function(t,n){return s("mt-tab-item",{key:n,staticClass:"xs-icon",attrs:{id:n},nativeOn:{click:function(s){e.getLayerFn(t.BuildingNum)}}},[e._v(e._s(t.BuildingName))])}),e._v(" "),s("span",{staticClass:"edit-class xs-icon icon-edit",on:{click:function(t){e.editBuildingFn(e.layer[0])}}})],2),e._v(" "),s("div",{staticStyle:{height:"5px"}}),e._v(" "),s("lazy",{attrs:{time:450}},e._l(e.layers,function(t,n){return s("div",{key:n,staticStyle:{background:"white","margin-bottom":"5px"}},[s("mt-cell-swipe",{attrs:{right:[{content:"删除",style:{background:"red",color:"#fff"},handler:function(){return e.deleteBuildingFn(t)}}]}},[s("div",{staticClass:"list-text",attrs:{slot:"title"},slot:"title"},[s("span",{staticClass:"list-text-span"},[e._v(e._s(t[0]["Street Address 3"]))])]),e._v(" "),s("span",{staticClass:"edit-class xs-icon icon-edit",on:{click:function(s){e.editFloorFn(t)}}})]),e._v(" "),s("div",{staticClass:"assets-div co-flex co-wp"},e._l(t,function(t,n){return s("span",{key:n,class:{active:t["Serial Number"],selected:t.selected,modify:t.local},on:{click:function(s){e.roomFn(t)}}},[e._v(e._s(t["Street Address 4"]))])}))],1)})),e._v(" "),s("button-group",[s("mt-button",{staticClass:"single",nativeOn:{click:function(t){e.addFloorFn(t)}}},[e._v("新增楼层")])],1)],1)]),e._v(" "),s("mt-actionsheet",{attrs:{actions:[{name:"扫描",method:e.toScanFn},{name:"录入",method:e.toFillFn}]},model:{value:e.sheetVisible,callback:function(t){e.sheetVisible=t},expression:"sheetVisible"}}),e._v(" "),s("button-group",[s("mt-button",{directives:[{name:"show",rawName:"v-show",value:e.isSelect,expression:"isSelect"}],staticClass:"single",nativeOn:{click:function(t){e.toNextFn(t)}}},[e._v("下一步")])],1)],1)},staticRenderFns:[]},x=s("VU/8")(p,g,!1,function(e){s("zZom")},null,null);t.default=x.exports},dJ0E:function(e,t,s){(e.exports=s("FZ+f")(!1)).push([e.i,"\n@charset \"UTF-8\";\n/* ==================================================\n * \t\t\t \t\t 全局Sass变量\n * ================================================= */\n.assets .mint-navbar {\n  overflow-x: auto;\n}\n.assets .mint-navbar::-webkit-scrollbar {\n    display: none;\n}\n.assets .mint-navbar .mint-tab-item {\n    -webkit-box-flex: 0;\n        -ms-flex: none;\n            flex: none;\n    min-width: 80px;\n}\n.assets .mint-navbar .mint-tab-item-label:before {\n  content: '\\A157';\n  padding-right: 5px;\n}\n.assets .assets-div {\n  padding: 5px 0;\n  border-top: 1px solid #eaeaea;\n}\n.assets .assets-div span {\n  border: 1px solid #eaeaea;\n  border-radius: 6px;\n  margin: 5px 0;\n  margin-left: 3.5%;\n  width: 20%;\n  line-height: 25px;\n  text-align: center;\n  color: #777;\n  font-size: 0.75rem;\n}\n.assets .assets-div span.active {\n    border-color: #fff;\n    background-color: #7ce87c;\n    color: #fff;\n}\n.assets .assets-div span.selected {\n    border-color: #fff;\n    background-color: #2a64e8;\n    color: #fff;\n}\n.assets .assets-div span.modify {\n    border-color: #fff;\n    background-color: #efe24d;\n    color: #fff;\n}\n.assets .edit-class {\n  width: 30px;\n  font-size: 0.75rem;\n  position: absolute;\n  right: 0px;\n  height: 36px;\n  line-height: 36px;\n}\n.assets .mint-cell-swipe, .assets .mint-cell-swipe-button {\n  line-height: 36px;\n  min-height: 36px;\n}\n.read.mint-content {\n  padding-bottom: 2rem;\n}\n.read span.edit-class {\n  display: none;\n}\n.read button {\n  display: none;\n}\n",""])},zZom:function(e,t,s){var n=s("dJ0E");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);s("rjj0")("1e553abe",n,!0)}});